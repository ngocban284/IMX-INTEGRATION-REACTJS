{"ast":null,"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.reporter = exports.formatValidationErrors = exports.formatValidationError = exports.TYPE_MAX_LEN = void 0;\n/**\n * An [io-ts Reporter](https://gcanti.github.io/io-ts/modules/Reporter.ts.html#reporter-interface).\n *\n * @example\n *\n * import * as t from 'io-ts';\n * import Reporter from 'io-ts-reporters';\n *\n * const User = t.interface({ name: t.string });\n *\n * assert.deepEqual(\n *   Reporter.report(User.decode({ nam: 'Jane' })),\n *   ['Expecting string at name but instead got: undefined'],\n * )\n * assert.deepEqual( Reporter.report(User.decode({ name: 'Jane' })), [])\n *\n * @since 1.2.0\n */\n\nvar A = require(\"fp-ts/lib/Array\");\n\nvar E = require(\"fp-ts/lib/Either\");\n\nvar NEA = require(\"fp-ts/lib/NonEmptyArray\");\n\nvar O = require(\"fp-ts/lib/Option\");\n\nvar R = require(\"fp-ts/lib/Record\");\n\nvar pipeable_1 = require(\"fp-ts/lib/pipeable\");\n\nvar t = require(\"io-ts\");\n\nvar utils_1 = require(\"./utils\");\n\nvar isUnionType = function (_a) {\n  var type = _a.type;\n  return type instanceof t.UnionType;\n};\n\nvar jsToString = function (value) {\n  return value === undefined ? 'undefined' : JSON.stringify(value);\n};\n\nvar keyPath = function (ctx) {\n  // The context entry with an empty key is the original\n  // type (\"default context\"), not a type error.\n  return ctx.map(function (c) {\n    return c.key;\n  }).filter(Boolean).join('.');\n}; // The actual error is last in context\n\n\nvar getErrorFromCtx = function (validation) {\n  // https://github.com/gcanti/fp-ts/pull/544/files\n  return A.last(validation.context);\n};\n\nvar getValidationContext = function (validation) {\n  // https://github.com/gcanti/fp-ts/pull/544/files\n  return validation.context;\n};\n/**\n * @category internals\n * @since 1.2.1\n */\n\n\nexports.TYPE_MAX_LEN = 160; // Two lines of 80-col text\n\nvar truncateType = function (type, options) {\n  if (options === void 0) {\n    options = {};\n  }\n\n  var _a = options.truncateLongTypes,\n      truncateLongTypes = _a === void 0 ? true : _a;\n\n  if (truncateLongTypes && type.length > exports.TYPE_MAX_LEN) {\n    return type.slice(0, exports.TYPE_MAX_LEN - 3) + \"...\";\n  }\n\n  return type;\n};\n\nvar errorMessageSimple = function (expectedType, path, error, options) {\n  // https://github.com/elm-lang/core/blob/18c9e84e975ed22649888bfad15d1efdb0128ab2/src/Native/Json.js#L199\n  return [\"Expecting \" + truncateType(expectedType, options), path === '' ? '' : \"at \" + path, \"but instead got: \" + jsToString(error.value), error.message ? \"(\" + error.message + \")\" : ''].filter(Boolean).join(' ');\n};\n\nvar errorMessageUnion = function (expectedTypes, path, value, options) {\n  // https://github.com/elm-lang/core/blob/18c9e84e975ed22649888bfad15d1efdb0128ab2/src/Native/Json.js#L199\n  return ['Expecting one of:\\n', expectedTypes.map(function (type) {\n    return \"    \" + truncateType(type, options);\n  }).join('\\n'), path === '' ? '\\n' : \"\\nat \" + path + \" \", \"but instead got: \" + jsToString(value)].filter(Boolean).join('');\n}; // Find the union type in the list of ContextEntry\n// The next ContextEntry should be the type of this branch of the union\n\n\nvar findExpectedType = function (ctx) {\n  return pipeable_1.pipe(ctx, A.findIndex(isUnionType), O.chain(function (n) {\n    return A.lookup(n + 1, ctx);\n  }));\n};\n\nvar formatValidationErrorOfUnion = function (path, errors, options) {\n  var expectedTypes = pipeable_1.pipe(errors, A.map(getValidationContext), A.map(findExpectedType), A.compact);\n  var value = pipeable_1.pipe(expectedTypes, A.head, O.map(function (v) {\n    return v.actual;\n  }), O.getOrElse(function () {\n    return undefined;\n  }));\n  var expected = expectedTypes.map(function (_a) {\n    var type = _a.type;\n    return type.name;\n  });\n  return expected.length > 0 ? O.some(errorMessageUnion(expected, path, value, options)) : O.none;\n};\n\nvar formatValidationCommonError = function (path, error, options) {\n  return pipeable_1.pipe(error, getErrorFromCtx, O.map(function (errorContext) {\n    return errorMessageSimple(errorContext.type.name, path, error, options);\n  }));\n};\n\nvar groupByKey = NEA.groupBy(function (error) {\n  return pipeable_1.pipe(error.context, utils_1.takeUntil(isUnionType), keyPath);\n});\n\nvar format = function (path, errors, options) {\n  return NEA.tail(errors).length > 0 ? formatValidationErrorOfUnion(path, errors, options) : formatValidationCommonError(path, NEA.head(errors), options);\n};\n/**\n * Format a single validation error.\n *\n * @category formatters\n * @since 1.0.0\n */\n\n\nexports.formatValidationError = function (error, options) {\n  return formatValidationCommonError(keyPath(error.context), error, options);\n};\n/**\n * Format validation errors (`t.Errors`).\n *\n * @example\n * import * as E from 'fp-ts/lib/Either'\n * import * as t from 'io-ts'\n * import { formatValidationErrors } from 'io-ts-reporters'\n *\n * const result = t.string.decode(123)\n *\n * assert.deepEqual(\n *   E.mapLeft(formatValidationErrors)(result),\n *   E.left(['Expecting string but instead got: 123'])\n * )\n *\n * @category formatters\n * @since 1.2.0\n */\n\n\nexports.formatValidationErrors = function (errors, options) {\n  return pipeable_1.pipe(errors, groupByKey, R.mapWithIndex(function (path, errors) {\n    return format(path, errors, options);\n  }), R.compact, R.toArray, A.map(function (_a) {\n    var _key = _a[0],\n        error = _a[1];\n    return error;\n  }));\n};\n/**\n * Deprecated, use the default export instead.\n *\n * @category deprecated\n * @deprecated\n * @since 1.0.0\n */\n\n\nexports.reporter = function (validation, options) {\n  return pipeable_1.pipe(validation, E.mapLeft(function (errors) {\n    return exports.formatValidationErrors(errors, options);\n  }), E.fold(function (errors) {\n    return errors;\n  }, function () {\n    return [];\n  }));\n};\n\nvar prettyReporter = {\n  report: exports.reporter\n};\nexports.default = prettyReporter;","map":{"version":3,"mappings":"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","names":["isUnionType","_a","type","t","UnionType","jsToString","value","undefined","JSON","stringify","keyPath","ctx","map","key","filter","Boolean","join","getErrorFromCtx","validation","last","context","getValidationContext","exports","truncateType","options","truncateLongTypes","length","slice","errorMessageSimple","expectedType","path","error","message","errorMessageUnion","expectedTypes","findExpectedType","A","findIndex","O","chain","lookup","n","formatValidationErrorOfUnion","errors","pipeable_1","compact","head","actual","getOrElse","expected","name","some","none","formatValidationCommonError","errorContext","groupByKey","NEA","groupBy","utils_1","format","tail","R","mapWithIndex","toArray","_key","E","mapLeft","fold","prettyReporter","report"],"sourceRoot":"","sources":["../../src/index.ts"],"sourcesContent":[null]},"metadata":{},"sourceType":"script"}